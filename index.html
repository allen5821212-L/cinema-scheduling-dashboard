<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>影城排片 DASHBOARD v3.3（含檢查＋匯入/情境/匯出）</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
<header class="app-header">
  <h1>影城排片 DASHBOARD</h1>
  <div class="sub">v3.3：檢查＋Excel/JSON 匯入＋情境＋匯出；新增上座率夾限、NaN 防護、單位提示、每片長片加價</div>
</header>

<main class="container">
  <section class="card">
    <h2>一、輸入參數</h2>
    <div class="grid two-col">
      <div>
        <h3>基本設定</h3>
        <div class="row"><label>放映時數上限</label><input id="limitTime" type="number" value="98" step="0.1"></div>
        <div class="row"><label>清潔工時上限</label><input id="limitClean" type="number" value="60" step="0.1"></div>
        <div class="row"><label>大廳場次上限</label><input id="limitBigShows" type="number" value="30"></div>
        <div class="row"><label>小廳場次上限</label><input id="limitSmallShows" type="number" value="50"></div>
        <div class="row"><label>每片最少場次</label><input id="minPerTitle" type="number" value="2"></div>
      </div>

      <div>
        <h3>座位/上座率（％）/需求</h3>
        <div class="row"><label>大廳座位</label><input id="capBig" type="number" value="400"></div>
        <div class="row"><label>小廳座位</label><input id="capSmall" type="number" value="200"></div>
        <div class="row with-unit"><label>鬼滅(大)上座率</label><input id="occDemonBig" type="number" value="85"><span class="unit">%</span></div>
        <div class="row with-unit"><label>鬼滅(小)上座率</label><input id="occDemonSmall" type="number" value="90"><span class="unit">%</span></div>
        <div class="row with-unit"><label>F1(大)上座率</label><input id="occF1Big" type="number" value="90"><span class="unit">%</span></div>
        <div class="row with-unit"><label>F1(小)上座率</label><input id="occF1Small" type="number" value="95"><span class="unit">%</span></div>
        <div class="row"><label>鬼滅人次上限</label><input id="demandDemon" type="number" value="7000"></div>
        <div class="row"><label>F1 人次上限</label><input id="demandF1" type="number" value="6000"></div>
      </div>

      <div>
        <h3>票價/片長</h3>
        <div class="row"><label>鬼滅全票</label><input id="priceDemon" type="number" value="450"></div>
        <div class="row"><label>鬼滅片長(hr)</label><input id="timeDemon" type="number" value="2.6" step="0.1"></div>
        <div class="row"><label>鬼滅長片加價</label><input id="longFeeDemon" type="number" value="30"></div>
        <div class="row"><label>鬼滅平均票價</label><input id="avgPriceDemon" type="number" value="300"></div>
        <div class="row"><label>平均票價已含長片加價（鬼滅）</label><input id="avgIncludesLongFeeDemon" type="checkbox"></div>

        <div class="row"><label>F1 全票</label><input id="priceF1" type="number" value="420"></div>
        <div class="row"><label>F1 片長(hr)</label><input id="timeF1" type="number" value="2.1" step="0.1"></div>
        <div class="row"><label>F1 長片加價</label><input id="longFeeF1" type="number" value="0"></div>
        <div class="row"><label>F1 平均票價</label><input id="avgPriceF1" type="number" value="260"></div>
        <div class="row"><label>平均票價已含長片加價（F1）</label><input id="avgIncludesLongFeeF1" type="checkbox"></div>
      </div>

      <div>
        <h3>清潔/成本</h3>
        <div class="row"><label>鬼滅(大)清潔/場</label><input id="cleanDemonBig" type="number" value="3" step="0.1"></div>
        <div class="row"><label>鬼滅(小)清潔/場</label><input id="cleanDemonSmall" type="number" value="1.5" step="0.1"></div>
        <div class="row"><label>F1(大)清潔/場</label><input id="cleanF1Big" type="number" value="2" step="0.1"></div>
        <div class="row"><label>F1(小)清潔/場</label><input id="cleanF1Small" type="number" value="1" step="0.1"></div>
        <div class="row"><label>每人變動成本</label><input id="varCostPerHead" type="number" value="30"></div>
      </div>
    </div>

    <div class="actions">
      <button id="btnSolve">🚀 求解最佳排片</button>
      <button id="btnBase">載入 Base</button>

      <button id="btnExportCfg" class="secondary">導出配置（JSON）</button>
      <input id="importCfgFile" type="file" accept="application/json" style="display:none" />
      <button id="btnImportCfg" class="secondary">匯入配置（JSON）</button>

      <input id="excelFile" type="file" accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="display:none" />
      <button id="btnExcel" class="secondary">匯入 Excel（含情境）</button>
    </div>

    <div class="hint-box">
      <div><b>情境按鈕：</b>會自動掃描名含 Base / Scenario(2) / Scenario(3) 或「情境」字樣的工作表產生按鈕。</div>
      <div id="scenarioButtons" class="scenario-buttons"></div>
    </div>
  </section>

  <section class="card">
    <h2>二、最佳解 & 可視化</h2>
    <div id="kpi" class="kpi"></div>
    <canvas id="barChart" height="120"></canvas>
    <div class="actions">
      <button id="btnExportCSV" class="secondary">下載最佳解（CSV）</button>
      <button id="btnExportXLSX" class="secondary">下載最佳解（Excel）</button>
    </div>
  </section>

  <section class="card">
    <h2>三、檢查結果（自動）</h2>
    <ul id="checks" class="checks"></ul>
  </section>
</main>

<footer class="app-footer">© 2025 Screening Planner · MIT</footer>
</body>
</html>
